import{o as R,q as S,r as Z,s as $,g as y,u as x,v as G,d as ee,p as A,x as w,y as E}from"./projections-55f0cb18.js";function P(e,n,t){if(t===void 0&&(t={}),t.final===!0)return te(e,n);var r=R(e),a=R(n),d=S(r[0]),l=S(a[0]),c=S(r[1]),o=S(a[1]),u=Math.sin(l-d)*Math.cos(o),m=Math.cos(c)*Math.sin(o)-Math.sin(c)*Math.cos(o)*Math.cos(l-d);return Z(Math.atan2(u,m))}function te(e,n){var t=P(n,e);return t=(t+180)%360,t}function ne(e,n){return e.holes.filter(t=>t.index==n)[0]}function oe(e,n){e.holes.push(n)}function re(e,n){e.strokes.push(n)}function ie(e,n){e.round=n}function M(e,n){return e.holes[n]}function F(e,n){const t=M(e,n);if(t)return t.pin}function se(e,n,t){return M(e,n).strokes[t]}function ae(e,n){return se(e,n.holeIndex,n.index+1)}function H(e,n){const t=ae(e,n);return t?t.start:F(e,n.holeIndex)}function ce(e,n){let t=pe();const r={round:null,holes:[],strokes:[]},a={name:e.course,id:e.courseId};for(let l of e.holes){const c=l.pin;let o=he(l),u=l.strokes.reduceRight((i,s)=>{const p=i.srnext,h=i.strokeEnd,f=$([s.start.y,s.start.x],[s.aim.y,s.aim.x],[c.y,c.x],s.dispersion,a,s.terrain),D=s.index,X=s.holeIndex,_=f.properties.terrain,J=y(s.start,s.aim),L=y(s.start,c),N=y(s.start,h),U=ue(s,e,h),V=me(s,e,f,c),k=f.properties.strokesRemainingStart,b=f.properties.strokesRemainingStart-p-1,T=f.properties.weightedStrokesGained,j=b-T,q=f.features.reduce((W,Y)=>W+(Y.properties.strokesGained<=b),0)/f.features.length,z=P(x(s.start),x(s.aim)),K=P(x(s.start),x(c)),Q=P(x(s.start),x(h)),v={index:D,holeIndex:X,club:s.club,terrain:_,distanceToAim:J,distanceToPin:L,distanceToActual:N,proximityActualToAim:U,proximityActualToPin:V,strokesRemaining:k,strokesGained:b,strokesGainedPredicted:T,strokesGainedOverPredicted:j,strokesGainedPercentile:q,bearingAim:z,bearingPin:K,bearingActual:Q};return re(r,v),s.index==0&&(o.strokesRemaining=k,o.par===void 0&&(o.par=Math.round(k))),i.srnext=k,i.strokeEnd=s.start,i.strokes.push(v),i},{srnext:0,strokes:[],strokeEnd:c}),m=g(u.strokes);o={...o,...m},oe(r,o)}let d=g(r.strokes);return t={...t,...d},r.holes.forEach(l=>{t.par+=l.par,t.strokesRemaining+=l.strokesRemaining}),ie(r,t),r}function de(e,n){let t=[],r=[],a=[],d=[];const l={to_unit:n||"yds",include_unit:!1};return e.strokes.forEach(c=>{const o=parseFloat(ee(c.distanceToAim,l)),u=ne(e,c.holeIndex);c.club=="P"||c.terrain=="green"?t.push(c):o<=100?r.push(c):c.index==0&&u.par>3?d.push(c):a.push(c)}),{putts:t,chips:r,approaches:a,drives:d}}function le(e,n){const t=de(e,n);return{putts:g(t.putts),chips:g(t.chips),approaches:g(t.approaches),drives:g(t.drives)}}const C=e=>e.reduce((n,t)=>n+t),I=e=>C(e)/e.length;function g(e){if(e.length==0)return;let n=fe(),t={strokesGained:[],strokesGainedPredicted:[],strokesGainedPercentile:[],proximityPercentile:[]};const r={strokesGained:C,strokesGainedPredicted:C,strokesGainedPercentile:I,proximityPercentile:I};e.forEach(a=>{for(let d in t)d=="proximityPercentile"?t[d].push(a.proximityActualToAim[d]):t[d].push(a[d])});for(let a in t)n[a]=r[a](t[a]);return n.strokes=e.length,n}function O(e,n,t){function r(h){return h*Math.PI/180}const a=A([e.x,e.y]),d=A([n.x,n.y]),l=A([t.x,t.y]),c=w(a,l,{units:"meters"}),o=w(a,d,{units:"meters"}),u=r(P(a,l)),m=r(P(a,d)),i=u-m,s=c*Math.sin(i),p=c*Math.cos(i);return[s,o-p]}function ue(e,n,t){t||(t=H(n,e));const r=y(e.aim,t),a=e.dispersion>0?e.dispersion:-e.dispersion*y(e.aim,e.start),[d,l]=O(e.start,e.aim,t),c=2*E(-Math.abs(r),0,a),o=E(d,0,a),u=E(l,0,a);return{proximity:r,proximityCrossTrack:d,proximityAlongTrack:l,proximityPercentile:c,proximityPercentileCrossTrack:o,proximityPercentileAlongTrack:u}}function me(e,n,t,r){r||(r=F(n,e.holeIndex));const a=H(n,e),d=y(a,r),[l,c]=O(e.start,r,a),o=t.features.reduce((u,m)=>m.properties.distanceToHole>d?u+1:u,0)/t.features.length;return{proximity:d,proximityCrossTrack:l,proximityAlongTrack:c,proximityPercentile:o,proximityPercentileCrossTrack:void 0,proximityPercentileAlongTrack:void 0}}function pe(e){return{strokes:0,par:0,strokesRemaining:0,strokesGained:0,strokesGainedPredicted:0,strokesGainedPercentile:0,proximityPercentile:0,filter:e||void 0}}function he(e){return{index:e.index,par:e.par,strokes:e.strokes.length,strokesRemaining:0,strokesGained:0,strokesGainedPredicted:0,strokesGainedPercentile:0,proximityPercentile:0}}function fe(){return{strokes:0,strokesGained:0,strokesGainedPredicted:0,strokesGainedPercentile:0,proximityPercentile:0}}function xe(e){const n=G.scale(["red","black","green"]).domain([.2,.5,.8]),t=document.createElement("table"),r=document.createElement("thead"),a=document.createElement("tbody"),d=document.createElement("tr"),l=["Type","Strokes","Strokes Gained","Strokes Gained Predicted","Strokes Gained Percentile","Proximity Percentile"];l.forEach(m=>{const i=document.createElement("th");i.textContent=m,d.appendChild(i)}),r.appendChild(d),t.appendChild(r);let c=[];for(const[m,i]of Object.entries(e))i&&c.push([m,i.strokes.toString(),i.strokesGained,i.strokesGainedPredicted,i.strokesGainedPercentile,i.proximityPercentile]);let o=[],u=[];for(let m of c)if(m[0]!="total")for(let[i,s]of m.entries())typeof s=="number"&&(o[i]==null?o[i]=[s,s]:s<o[i][0]?o[i][0]=s:s>o[i][1]&&(o[i][1]=s));for(let[m,i]of o.entries())typeof i>"u"||(u[m]=G.scale(["red","black","green"]).domain(i));for(let m of c){const i=document.createElement("tr");for(let[s,p]of m.entries()){const h=document.createElement("td");h.textContent=typeof p=="number"?p.toFixed(3):p,l[s].includes("Percentile")?h.style.color=n(p):l[s].includes("Strokes Gained")&&(h.style.color=u[s](p)),i.appendChild(h)}a.appendChild(i)}return t.appendChild(a),t}function ge(e){const n=G.scale(["red","black","green"]).domain([.2,.5,.8]),t=G.scale(["red","black","green"]).domain([-.5,0,.3]),r=document.createElement("table"),a=document.createElement("thead"),d=document.createElement("tbody");r.appendChild(a),r.appendChild(d);const l=["Hole","Stroke","Club","Terrain","To Aim","Strokes Gained","Strokes Gained Predicted","Strokes Gained Percentile","Proximity to Aim Percentile"],c=document.createElement("tr");l.forEach(o=>{const u=document.createElement("th");u.textContent=o,c.appendChild(u)}),a.appendChild(c),e=[...e].sort((o,u)=>o.holeIndex*100+o.index-u.holeIndex*100-u.index);for(const o of e){const u=document.createElement("tr");[(o.holeIndex+1).toString(),(o.index+1).toString(),o.club,o.terrain,o.distanceToAim.toFixed(1),o.strokesGained,o.strokesGainedPredicted,o.strokesGainedPercentile,o.proximityActualToAim.proximityPercentile].forEach((i,s)=>{const p=document.createElement("td");p.textContent=typeof i=="number"?i.toFixed(3):i,l[s].includes("Percentile")?p.style.color=n(i):l[s].includes("Strokes Gained")&&(p.style.color=t(i)),u.appendChild(p)}),d.appendChild(u)}return r}function B(){const e=localStorage.getItem("displayUnit")?localStorage.getItem("displayUnit"):"yards",n=document.getElementById("breakdownTables"),t=document.createElement("progress");n.replaceChildren(t);let r=JSON.parse(localStorage.getItem("statsCache"));if(!r){const c=JSON.parse(localStorage.getItem("golfData"));r=ce(c),localStorage.setItem("statsCache",JSON.stringify(r))}const a=le(r,e);a.total=r.round;const d=xe(a),l=ge(r.strokes);n.replaceChildren(d,l)}function ye(){localStorage.removeItem("statsCache"),new Promise(()=>B())}function Pe(){new Promise(()=>B())}window.onload=Pe;document.getElementById("regenerate").addEventListener("click",ye);
